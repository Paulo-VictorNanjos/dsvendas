<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo WhatsApp PDF - DSVENDAS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .whatsapp-icon {
            font-size: 2em;
            color: #25d366;
        }
        
        .demo-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #25d366;
        }
        
        .button {
            background: #25d366;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }
        
        .button:hover {
            background: #128c7e;
        }
        
        .button.secondary {
            background: #007bff;
        }
        
        .button.secondary:hover {
            background: #0056b3;
        }
        
        .result {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .explanation {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .step h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .whatsapp-preview {
            background: #e5ddd5;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .message-bubble {
            background: #dcf8c6;
            padding: 10px 15px;
            border-radius: 7.5px;
            margin: 10px 0;
            position: relative;
            max-width: 300px;
            margin-left: auto;
        }
        
        .message-bubble::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 10px;
            width: 0;
            height: 0;
            border-left: 5px solid #dcf8c6;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }
        
        .pdf-link {
            color: #0084ff;
            text-decoration: underline;
            word-break: break-all;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="whatsapp-icon">ğŸ“±</span> Demo WhatsApp PDF - DSVENDAS</h1>
        
        <div class="explanation">
            <h3>ğŸ“‹ Como funciona o envio de PDF via WhatsApp:</h3>
            <p>
                âš ï¸ <strong>PROBLEMA IDENTIFICADO:</strong> O preview bonito (como Facebook) <strong>NÃƒO funciona com localhost</strong>.
                <br><br>
                <strong>ğŸ” Por que nÃ£o funciona localmente:</strong>
                <br>âŒ WhatsApp nÃ£o consegue acessar `localhost:3001`
                <br>âŒ NÃ£o consegue ler as meta tags para preview
                <br>âŒ SÃ³ envia texto simples, sem preview bonito
                <br><br>
                <strong>âœ… Como funciona em produÃ§Ã£o:</strong>
                <br>1ï¸âƒ£ Sistema roda em domÃ­nio pÃºblico (ex: `https://seudominio.com.br`)
                <br>2ï¸âƒ£ WhatsApp consegue acessar a URL
                <br>3ï¸âƒ£ LÃª as meta tags e gera preview bonito
                <br>4ï¸âƒ£ Mostra tÃ­tulo, descriÃ§Ã£o e imagem (igual Facebook)
                <br><br>
                <strong>ğŸ“± SoluÃ§Ã£o atual (funciona agora):</strong>
                <br>ğŸ”¹ Enviar link direto para download do PDF
                <br>ğŸ”¹ Em produÃ§Ã£o, implementar preview bonito
                <br>ğŸ”¹ Cliente baixa PDF normalmente
            </p>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ§ª Teste 1: Gerar Link de PDF</h2>
            <p>Primeiro, vamos gerar um link de PDF para um orÃ§amento de teste:</p>
            <button class="button secondary" onclick="generatePdfLink()">Gerar Link PDF</button>
            <div id="pdfResult" class="result"></div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ“± Teste 2: Mensagem do WhatsApp Web</h2>
            <p>Veja como fica a mensagem no WhatsApp Web (Ãºnica opÃ§Ã£o disponÃ­vel para navegadores):</p>
            <button class="button" onclick="generateWhatsAppMessage()">Gerar Mensagem WhatsApp</button>
            <div id="whatsappResult" class="result"></div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸš€ SoluÃ§Ã£o: Local vs ProduÃ§Ã£o</h2>
            <p>Veja a diferenÃ§a entre teste local e como funciona em produÃ§Ã£o:</p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="button" onclick="testLocalSolution()">ğŸ’» Teste Local (Funciona Agora)</button>
                <button class="button secondary" onclick="showProductionExample()">ğŸŒ Exemplo ProduÃ§Ã£o (Preview Bonito)</button>
            </div>
            
            <div id="shareResult" class="result"></div>
            
            <div class="explanation" style="margin-top: 15px;">
                <h4>ğŸ¯ DiferenÃ§as:</h4>
                <p><strong>ğŸ’» Local (localhost:3001):</strong> Funciona, mas sem preview bonito no WhatsApp</p>
                <p><strong>ğŸŒ ProduÃ§Ã£o (https://seudominio.com.br):</strong> Preview bonito igual Facebook</p>
                <p><strong>ğŸ”§ Para implementar:</strong> Publicar em servidor com domÃ­nio real</p>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>ğŸ“Š Status dos PDFs</h2>
            <p>Veja quantos PDFs estÃ£o armazenados no servidor:</p>
            <button class="button secondary" onclick="checkPdfStatus()">Verificar Status</button>
            <div id="statusResult" class="result"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ’¡ Para usar no seu frontend:</h3>
            <pre><code>// 1. Gerar URL do WhatsApp
const response = await axios.post('/api/orcamentos/123/whatsapp', {
  phoneNumber: '11999999999',
  customMessage: 'Mensagem personalizada'
});

// 2. Abrir WhatsApp
window.open(response.data.data.webUrl, '_blank');

// 3. O PDF fica disponÃ­vel por 24 horas no link:
// response.data.data.pdfDownloadUrl</code></pre>
        </div>
        
        <div class="step">
            <h3>ğŸš€ ImplementaÃ§Ã£o inteligente (Nativo + Fallback):</h3>
            <pre><code>async function shareOrcamentoWhatsApp(orcamentoId, phoneNumber) {
  try {
    // 1. Verificar se suporta compartilhamento nativo
    const canUseNative = navigator.share && navigator.canShare;
    
    // 2. Chamar API com o tipo apropriado
    const response = await axios.post(`/api/orcamentos/${orcamentoId}/whatsapp-advanced`, {
      phoneNumber: phoneNumber,
      shareType: canUseNative ? 'native' : 'link'
    });
    
    const data = response.data.data;
    
    // 3. Tentar compartilhamento nativo primeiro
    if (canUseNative && data.nativeShare.base64) {
      try {
        // Converter base64 para blob
        const pdfBlob = base64ToBlob(data.nativeShare.base64, 'application/pdf');
        const pdfFile = new File([pdfBlob], data.nativeShare.filename, { 
          type: 'application/pdf' 
        });
        
        // Compartilhar nativamente
        await navigator.share({
          title: 'ğŸ“„ OrÃ§amento DSVENDAS',
          text: data.message,
          files: [pdfFile]
        });
        
        return { success: true, method: 'native' };
      } catch (nativeError) {
        console.log('Compartilhamento nativo falhou, usando fallback...');
      }
    }
    
    // 4. Fallback: abrir WhatsApp Web tradicional
    window.open(data.webUrl, '_blank');
    return { success: true, method: 'web' };
    
  } catch (error) {
    console.error('Erro ao compartilhar:', error);
    return { success: false, error: error.message };
  }
}

function base64ToBlob(base64, mimeType) {
  const byteCharacters = atob(base64);
  const byteNumbers = new Array(byteCharacters.length);
  for (let i = 0; i < byteCharacters.length; i++) {
    byteNumbers[i] = byteCharacters.charCodeAt(i);
  }
  const byteArray = new Uint8Array(byteNumbers);
  return new Blob([byteArray], { type: mimeType });
}</code></pre>
        </div>
        
        <div class="explanation">
            <h3>ğŸ“± Vantagens de cada mÃ©todo:</h3>
            <p><strong>ğŸš€ Compartilhamento Nativo:</strong></p>
            <ul style="margin-left: 20px;">
                <li>âœ… Anexa PDF diretamente no WhatsApp</li>
                <li>âœ… ExperiÃªncia mais fluida para o usuÃ¡rio</li>
                <li>âœ… Funciona offline depois do download</li>
                <li>âœ… NÃ£o depende de links que podem expirar</li>
                <li>âš ï¸ SÃ³ funciona em dispositivos mÃ³veis modernos</li>
            </ul>
            
            <p><strong>ğŸ”— Compartilhamento Web:</strong></p>
            <ul style="margin-left: 20px;">
                <li>âœ… Funciona em qualquer navegador</li>
                <li>âœ… CompatÃ­vel com desktop e mobile</li>
                <li>âœ… NÃ£o depende de APIs especÃ­ficas</li>
                <li>âš ï¸ Cliente precisa clicar no link</li>
                <li>âš ï¸ Links expiram em 24 horas</li>
            </ul>
        </div>
        
        <div class="explanation">
            <h3>ğŸ” Realidade das SoluÃ§Ãµes:</h3>
            
            <p><strong>âŒ Por que nÃ£o funciona localmente:</strong></p>
            <ul style="margin-left: 20px; color: #721c24;">
                <li>âŒ WhatsApp nÃ£o consegue acessar localhost:3001</li>
                <li>âŒ Preview bonito precisa de URL pÃºblica</li>
                <li>âŒ Meta tags sÃ³ funcionam com domÃ­nio real</li>
                <li>âŒ Fica apenas texto simples na mensagem</li>
            </ul>
            
            <p><strong>âœ… Nossa soluÃ§Ã£o atual (funciona agora):</strong></p>
            <ul style="margin-left: 20px; color: #155724;">
                <li>âœ… Gera PDF no servidor</li>
                <li>âœ… Cria link seguro e temporÃ¡rio</li>
                <li>âœ… Abre WhatsApp Web com mensagem</li>
                <li>âœ… Cliente baixa PDF clicando no link</li>
                <li>âœ… Funciona em qualquer navegador</li>
            </ul>
            
            <p><strong>ğŸ¯ Para preview bonito em produÃ§Ã£o:</strong></p>
            <ul style="margin-left: 20px; color: #856404;">
                <li>ğŸŒ Publicar sistema em servidor com domÃ­nio (ex: https://seudominio.com.br)</li>
                <li>ğŸ”§ Usar BASE_URL=https://seudominio.com.br no .env</li>
                <li>ğŸ“± WhatsApp conseguirÃ¡ acessar as URLs e fazer preview</li>
                <li>ğŸ‰ Preview bonito aparecerÃ¡ automaticamente (igual Facebook)</li>
            </ul>
        </div>
        
        <div class="step">
            <h3>ğŸš€ Como implementar preview bonito em produÃ§Ã£o:</h3>
            <pre><code>// 1. Publicar sistema em servidor
// Ex: DigitalOcean, AWS, Heroku, etc.

// 2. Configurar domÃ­nio
// Ex: https://seudominio.com.br

// 3. Atualizar .env em produÃ§Ã£o
BASE_URL=https://seudominio.com.br
PORT=3001

// 4. Usar nossa API normalmente
const response = await axios.post('/api/orcamentos/123/whatsapp', {
  phoneNumber: '11999999999',
  usePreview: true  // â† Ativa preview bonito
});

// 5. WhatsApp mostrarÃ¡ preview bonito automaticamente!
window.open(response.data.data.webUrl, '_blank');</code></pre>
        </div>
        
        <div class="explanation">
            <h3>ğŸ“± Resultado em produÃ§Ã£o:</h3>
            <p><strong>WhatsApp mostrarÃ¡:</strong></p>
            <ul style="margin-left: 20px; color: #155724;">
                <li>ğŸ–¼ï¸ Imagem/logo da empresa</li>
                <li>ğŸ“‹ TÃ­tulo: "OrÃ§amento #123 - DSVENDAS"</li>
                <li>ğŸ“ DescriÃ§Ã£o: "OrÃ§amento digital da DSVENDAS..."</li>
                <li>ğŸ”— Link clicÃ¡vel para pÃ¡gina bonita</li>
                <li>ğŸ“„ BotÃ£o de download do PDF na pÃ¡gina</li>
            </ul>
            <p><strong>ğŸ¯ ExperiÃªncia idÃªntica ao Facebook!</strong></p>
        </div>
        
        <div class="demo-section">
            <h2>ğŸš€ SOLUÃ‡ÃƒO DEFINITIVA: WhatsApp Cloud API</h2>
            <p>Com a API oficial do WhatsApp conseguimos anexar PDFs diretamente! ğŸ‰</p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="button" onclick="testWhatsAppCloudAPI()">ğŸ§ª Testar ConfiguraÃ§Ã£o API</button>
                <button class="button secondary" onclick="showCloudAPIExample()">ğŸ“‹ Exemplo de Uso</button>
            </div>
            
            <div id="cloudApiResult" class="result"></div>
            
            <div class="explanation" style="margin-top: 15px;">
                <h4>ğŸ¯ Vantagens da API Oficial:</h4>
                <p><strong>âœ… PDF anexado diretamente</strong> - Como apps nativos!</p>
                <p><strong>âœ… NÃ£o abre WhatsApp Web</strong> - Envio automÃ¡tico</p>
                <p><strong>âœ… Funciona com localhost</strong> - NÃ£o precisa domÃ­nio pÃºblico</p>
                <p><strong>âœ… Status de entrega</strong> - Sabe se foi entregue</p>
                <p><strong>âœ… Mais profissional</strong> - Sem limitaÃ§Ãµes de browser</p>
            </div>
        </div>
    </div>

    <script>
        async function generatePdfLink() {
            const resultDiv = document.getElementById('pdfResult');
            resultDiv.innerHTML = '<div class="status">Gerando PDF...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/debug/create-test-pdf', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… PDF gerado com sucesso!</div>
                        <p><strong>ğŸ“„ Arquivo:</strong> ${data.data.filename}</p>
                        <p><strong>ğŸ“ Tamanho:</strong> ${data.data.size} bytes</p>
                        <p><strong>ğŸ”— Link:</strong> <a href="${data.data.downloadUrl}" target="_blank" class="pdf-link">${data.data.downloadUrl}</a></p>
                        <p><strong>ğŸ•’ Expira em:</strong> 24 horas</p>
                        <br>
                        <a href="${data.data.downloadUrl}" target="_blank" class="button">ğŸ“¥ Baixar PDF de Teste</a>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${error.message}</div>`;
            }
        }
        
        async function generateWhatsAppMessage() {
            const resultDiv = document.getElementById('whatsappResult');
            resultDiv.innerHTML = '<div class="status">Gerando mensagem...</div>';
            resultDiv.classList.add('show');
            
            // Simular uma mensagem do WhatsApp
            const mockMessage = `ğŸ¢ *DSVENDAS* - OrÃ§amento Digital

OlÃ¡ *Cliente Teste*! ğŸ‘‹

ğŸ“‹ *OrÃ§amento #123*
ğŸ“… Data: ${new Date().toLocaleDateString('pt-BR')}
ğŸ’° Valor: R$ 1.234,56
ğŸ‘¨â€ğŸ’¼ Vendedor: JoÃ£o Silva

ğŸ“„ *BAIXAR ORÃ‡AMENTO EM PDF:*
http://localhost:3001/api/download-pdf/exemplo_token_123

ğŸ’¡ *Como baixar:*
1ï¸âƒ£ Clique no link acima
2ï¸âƒ£ O PDF serÃ¡ baixado automaticamente
3ï¸âƒ£ VÃ¡lido por 24 horas

ğŸ“ DÃºvidas? Entre em contato conosco!

Atenciosamente,
*Equipe DSVENDAS* âœ¨`;
            
            resultDiv.innerHTML = `
                <div class="status success">âœ… Mensagem gerada!</div>
                <h4>ğŸ“± Preview da mensagem no WhatsApp:</h4>
                <div class="whatsapp-preview">
                    <div class="message-bubble">
                        ${mockMessage.replace(/\n/g, '<br>')}
                    </div>
                </div>
                <p><em>âš ï¸ O cliente precisa clicar no link para baixar o PDF</em></p>
            `;
        }
        
        async function checkPdfStatus() {
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = '<div class="status">Verificando status...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/debug/temp-pdfs');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… Status obtido!</div>
                        <p><strong>ğŸ“Š Total de PDFs:</strong> ${data.data.total}</p>
                        <p><strong>ğŸ”„ Sistema inicializado:</strong> ${data.data.initialized ? 'Sim' : 'NÃ£o'}</p>
                        <pre>${JSON.stringify(data.data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${error.message}</div>`;
            }
        }
        
        async function testLocalSolution() {
            const resultDiv = document.getElementById('shareResult');
            resultDiv.innerHTML = '<div class="status">Testando soluÃ§Ã£o local...</div>';
            resultDiv.classList.add('show');
            
            try {
                // Gerar PDF de teste
                const pdfResponse = await fetch('/api/debug/create-test-pdf', { method: 'POST' });
                const pdfData = await pdfResponse.json();
                
                if (pdfData.success) {
                    // Simular mensagem do WhatsApp
                    const message = `ğŸ“‹ *OrÃ§amento #TESTE* - DSVENDAS

OlÃ¡! ğŸ‘‹

ğŸ“„ *BAIXAR ORÃ‡AMENTO EM PDF:*
${pdfData.data.downloadUrl}

ğŸ’¡ *Como baixar:*
1ï¸âƒ£ Clique no link acima
2ï¸âƒ£ O PDF serÃ¡ baixado automaticamente
3ï¸âƒ£ VÃ¡lido por 24 horas

Atenciosamente,
*Equipe DSVENDAS* âœ¨`;
                    
                    // Gerar URL do WhatsApp (exemplo)
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… SoluÃ§Ã£o local testada!</div>
                        <p>ğŸ”— MÃ©todo tradicional: Link do WhatsApp com mensagem de texto.</p>
                        <div class="whatsapp-preview">
                            <div class="message-bubble">
                                ${message.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                        <a href="${whatsappUrl}" target="_blank" class="button">ğŸ“± Abrir WhatsApp</a>
                        <p><em>âš ï¸ O cliente precisa clicar no link dentro da mensagem para baixar o PDF</em></p>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">âŒ Erro ao gerar PDF: ${pdfData.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${error.message}</div>`;
            }
        }
        
        async function showProductionExample() {
            const resultDiv = document.getElementById('shareResult');
            resultDiv.innerHTML = '<div class="status">Gerando exemplo de produÃ§Ã£o...</div>';
            resultDiv.classList.add('show');
            
            try {
                // Gerar PDF de teste
                const pdfResponse = await fetch('/api/debug/create-test-pdf', { method: 'POST' });
                const pdfData = await pdfResponse.json();
                
                if (pdfData.success) {
                    // Simular mensagem do WhatsApp
                    const message = `ğŸ¢ *DSVENDAS* - OrÃ§amento Digital

OlÃ¡ *Cliente Teste*! ğŸ‘‹

ğŸ“‹ *OrÃ§amento #TESTE*
ğŸ“… Data: ${new Date().toLocaleDateString('pt-BR')}
ğŸ’° Valor: R$ 1.234,56
ğŸ‘¨â€ğŸ’¼ Vendedor: JoÃ£o Silva

ğŸ–¼ï¸ *VER E BAIXAR ORÃ‡AMENTO:*
${window.location.origin}${pdfData.data.downloadUrl}

ğŸ’¡ *Preview inteligente:*
1ï¸âƒ£ Clique no link para ver o preview
2ï¸âƒ£ Baixe o PDF diretamente da pÃ¡gina
3ï¸âƒ£ Link vÃ¡lido por 24 horas

ğŸ“ DÃºvidas? Entre em contato conosco!

Atenciosamente,
*Equipe DSVENDAS* âœ¨`;
                    
                    // Gerar URL do WhatsApp
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… Exemplo de produÃ§Ã£o gerado!</div>
                        <p>ğŸ‰ <strong>Agora SIM parece que o arquivo estÃ¡ anexado!</strong></p>
                        
                        <h4>ğŸ–¼ï¸ Como fica no WhatsApp:</h4>
                        <div style="background: #e5ddd5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                            <div style="background: #dcf8c6; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                                ğŸ“‹ OrÃ§amento #TESTE - DSVENDAS<br>
                                <small>OrÃ§amento digital da DSVENDAS. Clique para visualizar...</small>
                            </div>
                            <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 12px;">
                                <strong>ğŸ–¼ï¸ PREVIEW BONITO</strong><br>
                                ğŸ“‹ OrÃ§amento #TESTE - DSVENDAS<br>
                                ğŸ’¡ OrÃ§amento digital da DSVENDAS. Clique para visualizar e baixar o PDF.
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin: 15px 0;">
                            <a href="${whatsappUrl}" target="_blank" class="button">ğŸ“± Abrir WhatsApp</a>
                            <a href="${pdfData.data.downloadUrl}" target="_blank" class="button secondary">ğŸ“„ Ver PDF Real</a>
                        </div>
                        
                        <div class="explanation" style="margin-top: 15px;">
                            <h4>ğŸ” O que acontece:</h4>
                            <p>âœ… WhatsApp detecta nosso link e mostra preview bonito</p>
                            <p>âœ… Cliente vÃª tÃ­tulo, descriÃ§Ã£o e imagem</p>
                            <p>âœ… Clica no preview e vai para nossa pÃ¡gina bonita</p>
                            <p>âœ… Baixa o PDF de lÃ¡</p>
                            <p>ğŸ¯ <strong>Resultado:</strong> ExperiÃªncia similar ao Facebook!</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">âŒ Erro ao gerar PDF: ${pdfData.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">âŒ Erro: ${error.message}</div>`;
            }
        }
        
        async function testWhatsAppCloudAPI() {
            const resultDiv = document.getElementById('cloudApiResult');
            resultDiv.innerHTML = '<div class="status">Testando configuraÃ§Ã£o da WhatsApp Cloud API...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/whatsapp-api/test');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">âœ… WhatsApp Cloud API configurada e funcionando!</div>
                        <p><strong>ğŸ“± Conta:</strong> ${data.account?.display_phone_number || 'Verificada'}</p>
                        <p><strong>ğŸ¯ Capacidades:</strong></p>
                        <ul style="margin-left: 20px;">
                            ${data.capabilities.map(cap => `<li>${cap}</li>`).join('')}
                        </ul>
                        <p><em>ğŸ‰ Pronto para anexar PDFs diretamente!</em></p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">âŒ ${data.message}</div>
                        ${data.configured === false ? `
                        <div style="margin-top: 15px;">
                            <h4>ğŸ”§ Como configurar:</h4>
                            <ol style="margin-left: 20px;">
                                <li>Acesse <a href="https://developers.facebook.com/apps/" target="_blank">Facebook Developers</a></li>
                                <li>Crie uma aplicaÃ§Ã£o WhatsApp Business</li>
                                <li>Obtenha Phone Number ID e Access Token</li>
                                <li>Configure no .env:
                                    <pre style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
WHATSAPP_PHONE_NUMBER_ID=123456789
WHATSAPP_ACCESS_TOKEN=EAAxxxxx...</pre>
                                </li>
                            </ol>
                        </div>
                        ` : ''}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">âŒ Erro ao testar API</div>
                    <p>Detalhes: ${error.message}</p>
                    <p><em>A API pode nÃ£o estar configurada ainda.</em></p>
                `;
            }
        }
        
        async function showCloudAPIExample() {
            const resultDiv = document.getElementById('cloudApiResult');
            resultDiv.innerHTML = '<div class="status">Mostrando exemplo de uso...</div>';
            resultDiv.classList.add('show');
            
            resultDiv.innerHTML = `
                <div class="status success">ğŸ“‹ Exemplo de uso da WhatsApp Cloud API</div>
                
                <h4>ğŸš€ Como usar no seu frontend:</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"><code>// Enviar orÃ§amento via WhatsApp Cloud API (ANEXO DIRETO!)
const response = await axios.post('/api/orcamentos/123/whatsapp-api', {
  phoneNumber: '11999999999'
});

if (response.data.success) {
  console.log('âœ… PDF enviado e anexado diretamente!');
  console.log('ğŸ“± Message ID:', response.data.data.whatsapp.messageId);
  console.log('ğŸ“„ Document ID:', response.data.data.whatsapp.documentId);
} else {
  console.log('âŒ Erro:', response.data.message);
}</code></pre>

                <h4>ğŸ“± O que acontece:</h4>
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <p><strong>1ï¸âƒ£</strong> Sistema gera PDF do orÃ§amento</p>
                    <p><strong>2ï¸âƒ£</strong> Faz upload para servidores do WhatsApp</p>
                    <p><strong>3ï¸âƒ£</strong> Envia mensagem de texto primeiro</p>
                    <p><strong>4ï¸âƒ£</strong> Envia PDF como anexo direto</p>
                    <p><strong>5ï¸âƒ£</strong> Cliente recebe PDF anexado (como app nativo!)</p>
                </div>
                
                <h4>ğŸ¯ Vantagens:</h4>
                <ul style="margin-left: 20px; color: #155724;">
                    <li>âœ… PDF aparece como anexo na conversa</li>
                    <li>âœ… NÃ£o precisa clicar em links</li>
                    <li>âœ… Funciona com localhost</li>
                    <li>âœ… Envio automÃ¡tico</li>
                    <li>âœ… Status de entrega</li>
                    <li>âœ… Mais profissional</li>
                </ul>
            `;
        }
    </script>
</body>
</html> 