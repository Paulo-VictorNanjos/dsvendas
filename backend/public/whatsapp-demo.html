<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo WhatsApp PDF - DSVENDAS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .whatsapp-icon {
            font-size: 2em;
            color: #25d366;
        }
        
        .demo-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #25d366;
        }
        
        .button {
            background: #25d366;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }
        
        .button:hover {
            background: #128c7e;
        }
        
        .button.secondary {
            background: #007bff;
        }
        
        .button.secondary:hover {
            background: #0056b3;
        }
        
        .result {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .explanation {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }
        
        .step {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .step h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .whatsapp-preview {
            background: #e5ddd5;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .message-bubble {
            background: #dcf8c6;
            padding: 10px 15px;
            border-radius: 7.5px;
            margin: 10px 0;
            position: relative;
            max-width: 300px;
            margin-left: auto;
        }
        
        .message-bubble::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 10px;
            width: 0;
            height: 0;
            border-left: 5px solid #dcf8c6;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }
        
        .pdf-link {
            color: #0084ff;
            text-decoration: underline;
            word-break: break-all;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="whatsapp-icon">üì±</span> Demo WhatsApp PDF - DSVENDAS</h1>
        
        <div class="explanation">
            <h3>üìã Como funciona o envio de PDF via WhatsApp:</h3>
            <p>
                ‚ö†Ô∏è <strong>PROBLEMA IDENTIFICADO:</strong> O preview bonito (como Facebook) <strong>N√ÉO funciona com localhost</strong>.
                <br><br>
                <strong>üîç Por que n√£o funciona localmente:</strong>
                <br>‚ùå WhatsApp n√£o consegue acessar `localhost:3001`
                <br>‚ùå N√£o consegue ler as meta tags para preview
                <br>‚ùå S√≥ envia texto simples, sem preview bonito
                <br><br>
                <strong>‚úÖ Como funciona em produ√ß√£o:</strong>
                <br>1Ô∏è‚É£ Sistema roda em dom√≠nio p√∫blico (ex: `https://seudominio.com.br`)
                <br>2Ô∏è‚É£ WhatsApp consegue acessar a URL
                <br>3Ô∏è‚É£ L√™ as meta tags e gera preview bonito
                <br>4Ô∏è‚É£ Mostra t√≠tulo, descri√ß√£o e imagem (igual Facebook)
                <br><br>
                <strong>üì± Solu√ß√£o atual (funciona agora):</strong>
                <br>üîπ Enviar link direto para download do PDF
                <br>üîπ Em produ√ß√£o, implementar preview bonito
                <br>üîπ Cliente baixa PDF normalmente
            </p>
        </div>
        
        <div class="demo-section">
            <h2>üß™ Teste 1: Gerar Link de PDF</h2>
            <p>Primeiro, vamos gerar um link de PDF para um or√ßamento de teste:</p>
            <button class="button secondary" onclick="generatePdfLink()">Gerar Link PDF</button>
            <div id="pdfResult" class="result"></div>
        </div>
        
        <div class="demo-section">
            <h2>üì± Teste 2: Mensagem do WhatsApp Web</h2>
            <p>Veja como fica a mensagem no WhatsApp Web (√∫nica op√ß√£o dispon√≠vel para navegadores):</p>
            <button class="button" onclick="generateWhatsAppMessage()">Gerar Mensagem WhatsApp</button>
            <div id="whatsappResult" class="result"></div>
        </div>
        
        <div class="demo-section">
            <h2>üöÄ Solu√ß√£o: Local vs Produ√ß√£o</h2>
            <p>Veja a diferen√ßa entre teste local e como funciona em produ√ß√£o:</p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="button" onclick="testLocalSolution()">üíª Teste Local (Funciona Agora)</button>
                <button class="button secondary" onclick="showProductionExample()">üåê Exemplo Produ√ß√£o (Preview Bonito)</button>
            </div>
            
            <div id="shareResult" class="result"></div>
            
            <div class="explanation" style="margin-top: 15px;">
                <h4>üéØ Diferen√ßas:</h4>
                <p><strong>üíª Local (localhost:3001):</strong> Funciona, mas sem preview bonito no WhatsApp</p>
                <p><strong>üåê Produ√ß√£o (https://seudominio.com.br):</strong> Preview bonito igual Facebook</p>
                <p><strong>üîß Para implementar:</strong> Publicar em servidor com dom√≠nio real</p>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>üìä Status dos PDFs</h2>
            <p>Veja quantos PDFs est√£o armazenados no servidor:</p>
            <button class="button secondary" onclick="checkPdfStatus()">Verificar Status</button>
            <div id="statusResult" class="result"></div>
        </div>
        
        <div class="step">
            <h3>üí° Para usar no seu frontend:</h3>
            <pre><code>// 1. Gerar URL do WhatsApp
const response = await axios.post('/api/orcamentos/123/whatsapp', {
  phoneNumber: '11999999999',
  customMessage: 'Mensagem personalizada'
});

// 2. Abrir WhatsApp
window.open(response.data.data.webUrl, '_blank');

// 3. O PDF fica dispon√≠vel por 24 horas no link:
// response.data.data.pdfDownloadUrl</code></pre>
        </div>
        
        <div class="step">
            <h3>üöÄ Implementa√ß√£o inteligente (Nativo + Fallback):</h3>
            <pre><code>async function shareOrcamentoWhatsApp(orcamentoId, phoneNumber) {
  try {
    // 1. Verificar se suporta compartilhamento nativo
    const canUseNative = navigator.share && navigator.canShare;
    
    // 2. Chamar API com o tipo apropriado
    const response = await axios.post(`/api/orcamentos/${orcamentoId}/whatsapp-advanced`, {
      phoneNumber: phoneNumber,
      shareType: canUseNative ? 'native' : 'link'
    });
    
    const data = response.data.data;
    
    // 3. Tentar compartilhamento nativo primeiro
    if (canUseNative && data.nativeShare.base64) {
      try {
        // Converter base64 para blob
        const pdfBlob = base64ToBlob(data.nativeShare.base64, 'application/pdf');
        const pdfFile = new File([pdfBlob], data.nativeShare.filename, { 
          type: 'application/pdf' 
        });
        
        // Compartilhar nativamente
        await navigator.share({
          title: 'üìÑ Or√ßamento DSVENDAS',
          text: data.message,
          files: [pdfFile]
        });
        
        return { success: true, method: 'native' };
      } catch (nativeError) {
        console.log('Compartilhamento nativo falhou, usando fallback...');
      }
    }
    
    // 4. Fallback: abrir WhatsApp Web tradicional
    window.open(data.webUrl, '_blank');
    return { success: true, method: 'web' };
    
  } catch (error) {
    console.error('Erro ao compartilhar:', error);
    return { success: false, error: error.message };
  }
}

function base64ToBlob(base64, mimeType) {
  const byteCharacters = atob(base64);
  const byteNumbers = new Array(byteCharacters.length);
  for (let i = 0; i < byteCharacters.length; i++) {
    byteNumbers[i] = byteCharacters.charCodeAt(i);
  }
  const byteArray = new Uint8Array(byteNumbers);
  return new Blob([byteArray], { type: mimeType });
}</code></pre>
        </div>
        
        <div class="explanation">
            <h3>üì± Vantagens de cada m√©todo:</h3>
            <p><strong>üöÄ Compartilhamento Nativo:</strong></p>
            <ul style="margin-left: 20px;">
                <li>‚úÖ Anexa PDF diretamente no WhatsApp</li>
                <li>‚úÖ Experi√™ncia mais fluida para o usu√°rio</li>
                <li>‚úÖ Funciona offline depois do download</li>
                <li>‚úÖ N√£o depende de links que podem expirar</li>
                <li>‚ö†Ô∏è S√≥ funciona em dispositivos m√≥veis modernos</li>
            </ul>
            
            <p><strong>üîó Compartilhamento Web:</strong></p>
            <ul style="margin-left: 20px;">
                <li>‚úÖ Funciona em qualquer navegador</li>
                <li>‚úÖ Compat√≠vel com desktop e mobile</li>
                <li>‚úÖ N√£o depende de APIs espec√≠ficas</li>
                <li>‚ö†Ô∏è Cliente precisa clicar no link</li>
                <li>‚ö†Ô∏è Links expiram em 24 horas</li>
            </ul>
        </div>
        
        <div class="explanation">
            <h3>üîç Realidade das Solu√ß√µes:</h3>
            
            <p><strong>‚ùå Por que n√£o funciona localmente:</strong></p>
            <ul style="margin-left: 20px; color: #721c24;">
                <li>‚ùå WhatsApp n√£o consegue acessar localhost:3001</li>
                <li>‚ùå Preview bonito precisa de URL p√∫blica</li>
                <li>‚ùå Meta tags s√≥ funcionam com dom√≠nio real</li>
                <li>‚ùå Fica apenas texto simples na mensagem</li>
            </ul>
            
            <p><strong>‚úÖ Nossa solu√ß√£o atual (funciona agora):</strong></p>
            <ul style="margin-left: 20px; color: #155724;">
                <li>‚úÖ Gera PDF no servidor</li>
                <li>‚úÖ Cria link seguro e tempor√°rio</li>
                <li>‚úÖ Abre WhatsApp Web com mensagem</li>
                <li>‚úÖ Cliente baixa PDF clicando no link</li>
                <li>‚úÖ Funciona em qualquer navegador</li>
            </ul>
            
            <p><strong>üéØ Para preview bonito em produ√ß√£o:</strong></p>
            <ul style="margin-left: 20px; color: #856404;">
                <li>üåê Publicar sistema em servidor com dom√≠nio (ex: https://seudominio.com.br)</li>
                <li>üîß Usar BASE_URL=https://seudominio.com.br no .env</li>
                <li>üì± WhatsApp conseguir√° acessar as URLs e fazer preview</li>
                <li>üéâ Preview bonito aparecer√° automaticamente (igual Facebook)</li>
            </ul>
        </div>
        
        <div class="step">
            <h3>üöÄ Como implementar preview bonito em produ√ß√£o:</h3>
            <pre><code>// 1. Publicar sistema em servidor
// Ex: DigitalOcean, AWS, Heroku, etc.

// 2. Configurar dom√≠nio
// Ex: https://seudominio.com.br

// 3. Atualizar .env em produ√ß√£o
BASE_URL=https://seudominio.com.br
PORT=3001

// 4. Usar nossa API normalmente
const response = await axios.post('/api/orcamentos/123/whatsapp', {
  phoneNumber: '11999999999',
  usePreview: true  // ‚Üê Ativa preview bonito
});

// 5. WhatsApp mostrar√° preview bonito automaticamente!
window.open(response.data.data.webUrl, '_blank');</code></pre>
        </div>
        
        <div class="explanation">
            <h3>üì± Resultado em produ√ß√£o:</h3>
            <p><strong>WhatsApp mostrar√°:</strong></p>
            <ul style="margin-left: 20px; color: #155724;">
                <li>üñºÔ∏è Imagem/logo da empresa</li>
                <li>üìã T√≠tulo: "Or√ßamento #123 - DSVENDAS"</li>
                <li>üìù Descri√ß√£o: "Or√ßamento digital da DSVENDAS..."</li>
                <li>üîó Link clic√°vel para p√°gina bonita</li>
                <li>üìÑ Bot√£o de download do PDF na p√°gina</li>
            </ul>
            <p><strong>üéØ Experi√™ncia id√™ntica ao Facebook!</strong></p>
        </div>
        
        <div class="demo-section">
            <h2>üöÄ SOLU√á√ÉO DEFINITIVA: WhatsApp Cloud API</h2>
            <p>Com a API oficial do WhatsApp conseguimos anexar PDFs diretamente! üéâ</p>
            
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="button" onclick="testWhatsAppCloudAPI()">üß™ Testar Configura√ß√£o API</button>
                <button class="button secondary" onclick="showCloudAPIExample()">üìã Exemplo de Uso</button>
            </div>
            
            <div id="cloudApiResult" class="result"></div>
            
            <div class="explanation" style="margin-top: 15px;">
                <h4>üéØ Vantagens da API Oficial:</h4>
                <p><strong>‚úÖ PDF anexado diretamente</strong> - Como apps nativos!</p>
                <p><strong>‚úÖ N√£o abre WhatsApp Web</strong> - Envio autom√°tico</p>
                <p><strong>‚úÖ Funciona com localhost</strong> - N√£o precisa dom√≠nio p√∫blico</p>
                <p><strong>‚úÖ Status de entrega</strong> - Sabe se foi entregue</p>
                <p><strong>‚úÖ Mais profissional</strong> - Sem limita√ß√µes de browser</p>
            </div>
        </div>
    </div>

    <script>
        async function generatePdfLink() {
            const resultDiv = document.getElementById('pdfResult');
            resultDiv.innerHTML = '<div class="status">Gerando PDF...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/debug/create-test-pdf', {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ PDF gerado com sucesso!</div>
                        <p><strong>üìÑ Arquivo:</strong> ${data.data.filename}</p>
                        <p><strong>üìè Tamanho:</strong> ${data.data.size} bytes</p>
                        <p><strong>üîó Link:</strong> <a href="${data.data.downloadUrl}" target="_blank" class="pdf-link">${data.data.downloadUrl}</a></p>
                        <p><strong>üïí Expira em:</strong> 24 horas</p>
                        <br>
                        <a href="${data.data.downloadUrl}" target="_blank" class="button">üì• Baixar PDF de Teste</a>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        async function generateWhatsAppMessage() {
            const resultDiv = document.getElementById('whatsappResult');
            resultDiv.innerHTML = '<div class="status">Gerando mensagem...</div>';
            resultDiv.classList.add('show');
            
            // Simular uma mensagem do WhatsApp
            const mockMessage = `üè¢ *DSVENDAS* - Or√ßamento Digital

Ol√° *Cliente Teste*! üëã

üìã *Or√ßamento #123*
üìÖ Data: ${new Date().toLocaleDateString('pt-BR')}
üí∞ Valor: R$ 1.234,56
üë®‚Äçüíº Vendedor: Jo√£o Silva

üìÑ *BAIXAR OR√áAMENTO EM PDF:*
http://localhost:3001/api/download-pdf/exemplo_token_123

üí° *Como baixar:*
1Ô∏è‚É£ Clique no link acima
2Ô∏è‚É£ O PDF ser√° baixado automaticamente
3Ô∏è‚É£ V√°lido por 24 horas

üìû D√∫vidas? Entre em contato conosco!

Atenciosamente,
*Equipe DSVENDAS* ‚ú®`;
            
            resultDiv.innerHTML = `
                <div class="status success">‚úÖ Mensagem gerada!</div>
                <h4>üì± Preview da mensagem no WhatsApp:</h4>
                <div class="whatsapp-preview">
                    <div class="message-bubble">
                        ${mockMessage.replace(/\n/g, '<br>')}
                    </div>
                </div>
                <p><em>‚ö†Ô∏è O cliente precisa clicar no link para baixar o PDF</em></p>
            `;
        }
        
        async function checkPdfStatus() {
            const resultDiv = document.getElementById('statusResult');
            resultDiv.innerHTML = '<div class="status">Verificando status...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/debug/temp-pdfs');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Status obtido!</div>
                        <p><strong>üìä Total de PDFs:</strong> ${data.data.total}</p>
                        <p><strong>üîÑ Sistema inicializado:</strong> ${data.data.initialized ? 'Sim' : 'N√£o'}</p>
                        <pre>${JSON.stringify(data.data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${data.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        async function testLocalSolution() {
            const resultDiv = document.getElementById('shareResult');
            resultDiv.innerHTML = '<div class="status">Testando solu√ß√£o local...</div>';
            resultDiv.classList.add('show');
            
            try {
                // Gerar PDF de teste
                const pdfResponse = await fetch('/api/debug/create-test-pdf', { method: 'POST' });
                const pdfData = await pdfResponse.json();
                
                if (pdfData.success) {
                    // Simular mensagem do WhatsApp
                    const message = `üìã *Or√ßamento #TESTE* - DSVENDAS

Ol√°! üëã

üìÑ *BAIXAR OR√áAMENTO EM PDF:*
${pdfData.data.downloadUrl}

üí° *Como baixar:*
1Ô∏è‚É£ Clique no link acima
2Ô∏è‚É£ O PDF ser√° baixado automaticamente
3Ô∏è‚É£ V√°lido por 24 horas

Atenciosamente,
*Equipe DSVENDAS* ‚ú®`;
                    
                    // Gerar URL do WhatsApp (exemplo)
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Solu√ß√£o local testada!</div>
                        <p>üîó M√©todo tradicional: Link do WhatsApp com mensagem de texto.</p>
                        <div class="whatsapp-preview">
                            <div class="message-bubble">
                                ${message.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                        <a href="${whatsappUrl}" target="_blank" class="button">üì± Abrir WhatsApp</a>
                        <p><em>‚ö†Ô∏è O cliente precisa clicar no link dentro da mensagem para baixar o PDF</em></p>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">‚ùå Erro ao gerar PDF: ${pdfData.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        async function showProductionExample() {
            const resultDiv = document.getElementById('shareResult');
            resultDiv.innerHTML = '<div class="status">Gerando exemplo de produ√ß√£o...</div>';
            resultDiv.classList.add('show');
            
            try {
                // Gerar PDF de teste
                const pdfResponse = await fetch('/api/debug/create-test-pdf', { method: 'POST' });
                const pdfData = await pdfResponse.json();
                
                if (pdfData.success) {
                    // Simular mensagem do WhatsApp
                    const message = `üè¢ *DSVENDAS* - Or√ßamento Digital

Ol√° *Cliente Teste*! üëã

üìã *Or√ßamento #TESTE*
üìÖ Data: ${new Date().toLocaleDateString('pt-BR')}
üí∞ Valor: R$ 1.234,56
üë®‚Äçüíº Vendedor: Jo√£o Silva

üñºÔ∏è *VER E BAIXAR OR√áAMENTO:*
${window.location.origin}${pdfData.data.downloadUrl}

üí° *Preview inteligente:*
1Ô∏è‚É£ Clique no link para ver o preview
2Ô∏è‚É£ Baixe o PDF diretamente da p√°gina
3Ô∏è‚É£ Link v√°lido por 24 horas

üìû D√∫vidas? Entre em contato conosco!

Atenciosamente,
*Equipe DSVENDAS* ‚ú®`;
                    
                    // Gerar URL do WhatsApp
                    const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
                    
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ Exemplo de produ√ß√£o gerado!</div>
                        <p>üéâ <strong>Agora SIM parece que o arquivo est√° anexado!</strong></p>
                        
                        <h4>üñºÔ∏è Como fica no WhatsApp:</h4>
                        <div style="background: #e5ddd5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                            <div style="background: #dcf8c6; padding: 12px; border-radius: 8px; margin-bottom: 10px;">
                                üìã Or√ßamento #TESTE - DSVENDAS<br>
                                <small>Or√ßamento digital da DSVENDAS. Clique para visualizar...</small>
                            </div>
                            <div style="background: white; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 12px;">
                                <strong>üñºÔ∏è PREVIEW BONITO</strong><br>
                                üìã Or√ßamento #TESTE - DSVENDAS<br>
                                üí° Or√ßamento digital da DSVENDAS. Clique para visualizar e baixar o PDF.
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin: 15px 0;">
                            <a href="${whatsappUrl}" target="_blank" class="button">üì± Abrir WhatsApp</a>
                            <a href="${pdfData.data.downloadUrl}" target="_blank" class="button secondary">üìÑ Ver PDF Real</a>
                        </div>
                        
                        <div class="explanation" style="margin-top: 15px;">
                            <h4>üîç O que acontece:</h4>
                            <p>‚úÖ WhatsApp detecta nosso link e mostra preview bonito</p>
                            <p>‚úÖ Cliente v√™ t√≠tulo, descri√ß√£o e imagem</p>
                            <p>‚úÖ Clica no preview e vai para nossa p√°gina bonita</p>
                            <p>‚úÖ Baixa o PDF de l√°</p>
                            <p>üéØ <strong>Resultado:</strong> Experi√™ncia similar ao Facebook!</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="status error">‚ùå Erro ao gerar PDF: ${pdfData.message}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="status error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        async function testWhatsAppCloudAPI() {
            const resultDiv = document.getElementById('cloudApiResult');
            resultDiv.innerHTML = '<div class="status">Testando configura√ß√£o da WhatsApp Cloud API...</div>';
            resultDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/whatsapp-api/test');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="status success">‚úÖ WhatsApp Cloud API configurada e funcionando!</div>
                        <p><strong>üì± Conta:</strong> ${data.account?.display_phone_number || 'Verificada'}</p>
                        <p><strong>üéØ Capacidades:</strong></p>
                        <ul style="margin-left: 20px;">
                            ${data.capabilities.map(cap => `<li>${cap}</li>`).join('')}
                        </ul>
                        <p><em>üéâ Pronto para anexar PDFs diretamente!</em></p>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="status error">‚ùå ${data.message}</div>
                        ${data.configured === false ? `
                        <div style="margin-top: 15px;">
                            <h4>üîß Como configurar:</h4>
                            <ol style="margin-left: 20px;">
                                <li>Acesse <a href="https://developers.facebook.com/apps/" target="_blank">Facebook Developers</a></li>
                                <li>Crie uma aplica√ß√£o WhatsApp Business</li>
                                <li>Obtenha Phone Number ID e Access Token</li>
                                <li>Configure no .env:
                                    <pre style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
WHATSAPP_PHONE_NUMBER_ID=123456789
WHATSAPP_ACCESS_TOKEN=EAAxxxxx...</pre>
                                </li>
                            </ol>
                        </div>
                        ` : ''}
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Erro ao testar API</div>
                    <p>Detalhes: ${error.message}</p>
                    <p><em>A API pode n√£o estar configurada ainda.</em></p>
                `;
            }
        }
        
        async function showCloudAPIExample() {
            const resultDiv = document.getElementById('cloudApiResult');
            resultDiv.innerHTML = '<div class="status">Mostrando exemplo de uso...</div>';
            resultDiv.classList.add('show');
            
            resultDiv.innerHTML = `
                <div class="status success">üìã Exemplo de uso da WhatsApp Cloud API</div>
                
                <h4>üöÄ Como usar no seu frontend:</h4>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"><code>// Enviar or√ßamento via WhatsApp Cloud API (ANEXO DIRETO!)
const response = await axios.post('/api/orcamentos/123/whatsapp-api', {
  phoneNumber: '11999999999'
});

if (response.data.success) {
  console.log('‚úÖ PDF enviado e anexado diretamente!');
  console.log('üì± Message ID:', response.data.data.whatsapp.messageId);
  console.log('üìÑ Document ID:', response.data.data.whatsapp.documentId);
} else {
  console.log('‚ùå Erro:', response.data.message);
}</code></pre>

                <h4>üì± O que acontece:</h4>
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <p><strong>1Ô∏è‚É£</strong> Sistema gera PDF do or√ßamento</p>
                    <p><strong>2Ô∏è‚É£</strong> Faz upload para servidores do WhatsApp</p>
                    <p><strong>3Ô∏è‚É£</strong> Envia mensagem de texto primeiro</p>
                    <p><strong>4Ô∏è‚É£</strong> Envia PDF como anexo direto</p>
                    <p><strong>5Ô∏è‚É£</strong> Cliente recebe PDF anexado (como app nativo!)</p>
                </div>
                
                <h4>üéØ Vantagens:</h4>
                <ul style="margin-left: 20px; color: #155724;">
                    <li>‚úÖ PDF aparece como anexo na conversa</li>
                    <li>‚úÖ N√£o precisa clicar em links</li>
                    <li>‚úÖ Funciona com localhost</li>
                    <li>‚úÖ Envio autom√°tico</li>
                    <li>‚úÖ Status de entrega</li>
                    <li>‚úÖ Mais profissional</li>
                </ul>
            `;
        }
    </script>
</body>
</html> 