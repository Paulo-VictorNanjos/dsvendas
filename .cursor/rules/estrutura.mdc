---
description: estrutura plataforma
globs: 
alwaysApply: false
---
ğŸ“Œ Resumo Geral
Desenvolver uma plataforma web moderna, utilizando React + TypeScript no frontend e Node.js + Express no backend, com um banco de dados prÃ³prio (PostgreSQL ou MySQL), realizando sincronizaÃ§Ã£o inteligente com o banco de dados de um sistema ERP jÃ¡ existente, conforme os arquivos .sql listados (clientes, orÃ§amentos, pedidos, regras fiscais etc.).

ğŸ” AutenticaÃ§Ã£o
Tela de login moderna (React) com autenticaÃ§Ã£o via e-mail e senha (prÃ³pria da plataforma).

ApÃ³s o login, o sistema reconhece o vendedor associado (pelo cÃ³digo ou e-mail relacionado no ERP).

A associaÃ§Ã£o entre conta da plataforma e vendedor ERP serÃ¡ feita por uma tabela de vinculaÃ§Ã£o (ex: vendedores_web).

ğŸ“š MÃ³dulos da Plataforma
1. Consulta de Clientes
VisualizaÃ§Ã£o dos clientes do ERP (somente leitura).

Filtros por nome, CNPJ, cidade, estado.

2. OrÃ§amentos
O vendedor cria um orÃ§amento baseado nos produtos do ERP.

Regras fiscais e regras por operaÃ§Ã£o sÃ£o aplicadas automaticamente.

As operaÃ§Ãµes disponÃ­veis:

Revenda de Mercadoria

BonificaÃ§Ã£o

ValidaÃ§Ã£o de sequÃªncia do nÃºmero de orÃ§amento via controle na plataforma.

Ao concluir, o orÃ§amento entra como pendente de sincronizaÃ§Ã£o.

3. Pedidos de Venda
O vendedor transforma um orÃ§amento em pedido.

NÃ£o pode editar o pedido apÃ³s enviado.

Pode visualizar o status atual via workflow:

Aguardando aprovaÃ§Ã£o

Aprovado

Em faturamento

Faturado

O pedido tambÃ©m Ã© sincronizado com o ERP com controle de cÃ³digo sequencial e regras fiscais.

4. ConfiguraÃ§Ãµes de OperaÃ§Ãµes
Tela de administraÃ§Ã£o onde o gestor pode:

Editar regras fiscais por operaÃ§Ã£o.

Ajustar CFOP, ICMS, PIS/COFINS e bonificaÃ§Ãµes.

Tabela refletida nas tabelas do ERP para garantir conformidade.

ğŸ” SincronizaÃ§Ã£o com o ERP
Banco da Web:
Tabelas locais: clientes_web, orcamentos_web, pedidos_web, produtos_web, regras_fiscais_web, sync_logs, etc.

SincronizaÃ§Ã£o:
ServiÃ§o agendado (cron job ou worker Node):

Verifica itens pendentes de sincronizaÃ§Ã£o.

Gera novo cÃ³digo sequencial conforme Ãºltima entrada no ERP.

Insere no banco do ERP e atualiza o status na plataforma (sincronizado, erro, pendente).

ValidaÃ§Ãµes antes do envio:

CÃ³digo de cliente vÃ¡lido

Regras fiscais aplicadas

Produtos existentes

ğŸ§  Regras de NegÃ³cio (Back-end)
Toda criaÃ§Ã£o de orÃ§amento e pedido deve:

Ter vÃ­nculo com um cliente e um vendedor ERP.

Validar o tipo de operaÃ§Ã£o e aplicar regras fiscais.

Ser registrada na tabela de controle (sync_logs) com:

ID local

Status

Tentativas

Data/hora da Ãºltima tentativa

CÃ³digo sequencial de pedidos/orÃ§amentos deve ser calculado com base no maior cÃ³digo atual do ERP + 1 (com travas de concorrÃªncia).

ğŸ§± Estrutura da API RESTful (Node.js + Express)
txt
Copiar
Editar
/auth
  POST /login
  POST /register (restrito a admins)

/clientes
  GET /        â†’ lista de clientes (consulta)
  GET /:id     â†’ detalhes do cliente

/orcamentos
  GET /        â†’ lista de orÃ§amentos do usuÃ¡rio logado
  POST /       â†’ cria novo orÃ§amento
  GET /:id     â†’ detalhes
  PUT /:id     â†’ editar antes do envio
  POST /:id/enviar â†’ envia para sincronizaÃ§Ã£o

/pedidos
  GET /        â†’ pedidos do vendedor
  GET /:id     â†’ detalhes do pedido
  POST /:id/sincronizar â†’ envia ao ERP

/regras
  GET /operacoes          â†’ tipos de operaÃ§Ã£o
  GET /fiscais/:op        â†’ regras fiscais por operaÃ§Ã£o
  PUT /fiscais/:op        â†’ editar regras

/sync
  GET /logs               â†’ histÃ³rico de sincronizaÃ§Ã£o
ğŸ—‚ï¸ Estrutura de Pastas (Backend)
arduino
Copiar
Editar
src/
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ authController.ts
â”‚   â”œâ”€â”€ orcamentoController.ts
â”‚   â”œâ”€â”€ pedidoController.ts
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ Cliente.ts
â”‚   â”œâ”€â”€ Orcamento.ts
â”‚   â”œâ”€â”€ Pedido.ts
â”‚   â”œâ”€â”€ RegraFiscal.ts
â”‚   â”œâ”€â”€ Vendedor.ts
â”‚   â””â”€â”€ SyncLog.ts
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ authRoutes.ts
â”‚   â”œâ”€â”€ orcamentoRoutes.ts
â”‚   â”œâ”€â”€ pedidoRoutes.ts
â”‚   â””â”€â”€ regraRoutes.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ syncService.ts
â”‚   â”œâ”€â”€ fiscalService.ts
â”œâ”€â”€ jobs/
â”‚   â””â”€â”€ syncJob.ts
â””â”€â”€ config/
    â””â”€â”€ db.ts
ğŸ’» Frontend (React + TypeScript)
AutenticaÃ§Ã£o (login moderno)

Layout estilo dashboard (ex: Material UI ou Tailwind + shadcn/ui)

PÃ¡ginas:

Dashboard

Clientes

OrÃ§amentos (criar, listar, editar)

Pedidos (visualizaÃ§Ã£o, workflow)

ConfiguraÃ§Ãµes (regras fiscais)


HistÃ³rico de sincronizaÃ§Ãµes